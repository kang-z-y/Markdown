# 云计算系统管理 03

- [命令行基础](#命令行基础)
- [目录及文件管理](#目录及文件管理)
- [文本内容操作](#文本内容操作)

## 命令行基础

- [如何编写命令行](#如何编写命令行)
  - 什么是命令
  - 命令行的一般格式
  - 快速编辑技巧
- [mount 挂载操作](#mount-挂载操作)
  - 什么是挂载
  - 挂载光盘或分区
  - 卸载已挂载的设备或分区

### 如何编写命令行

#### 什么是命令

- Linux 命令
  - 用来实现某一类功能的指令或程序
  - 命令的执行依赖于解释器（例如：`/bin/bash`）
- Linux 命令的分类
  - 内部命令：属于解释器的一部分
  - 外部命令：解释器之外的其他程序

![什么是命令](https://kkkkzzzzyy.oss-cn-beijing.aliyuncs.com/云计算/什么是命令.png)

#### 命令行的一般格式

- 基本用法
  - **`命令字 [选项]... [参数]...`**
  - ==选项==：调控命令的执行方式
    - 短选项：-l、-A、-c、-d、...
    - 多个短选项 ==> 复合选项：-lh、-lA、-ld、...
    - 长选项：--help、...
  - ==参数==：命令的操作对象，如目录、文件、...

#### 快速编辑技巧

- <kbd>Tab</kbd> 键自动补全
  - 可补齐命令字、选项、参数、文件路径、软件名、服务名
- 快捷键
  - <kbd>Ctrl</kbd>+<kbd>l</kbd>：清空整个屏幕
  - <kbd>Ctrl</kbd>+<kbd>c</kbd>：废弃当前编辑的命令行
  - <kbd>Esc</kbd>+<kbd>.</kbd> 或 <kbd>Alt</kbd>+<kbd>.</kbd>：粘贴上一个命令的参数
  - <kbd>Ctrl</kbd> + <kbd>u</kbd>：从光标处清空至行首
    <kbd>Ctrl</kbd> + <kbd>k</kbd>：从光标处清空至行尾
    <kbd>Ctrl</kbd> + <kbd>w</kbd>：往回删除一个单词（以空格界定）

### mount 挂载操作

#### 什么是挂载

- 挂载，装载
  - 将光盘/U 盘/分区/网络存储等设备装到某个 Linux 目录
  - 各种命令工具通过访问 Linux 目录来操作这些设备

- 命令行的 Linux 电脑插入 U 盘后不会自动挂载，需要使用 mount 挂载才能用
  - 格式：`mount /dev/设备名 /mnt`
- 允许：一个设备，挂载到不同的挂载点目录
  不允许：一个挂载点目录，挂载多个设备

#### 挂载光盘或分区

- 使用 `mount` 命令
  - 格式：`mount 设备路径 挂载点目录`

#### 卸载已挂载的光盘

- 使用 `umount` 命令
  - 卸载已挂载设备
  - 格式：`umount 挂载点目录`
- 使用 `lsof` 命令（List Open Files）
  - 查看挂载设备信息
  - 格式：`lsof 挂载点目录`

#### 案例：`mount` 挂载操作

问题描述
: 为虚拟机挂载光盘镜像（挂载目录 */mnt/dvd/*）

1. 首先为虚拟机添加光盘
   - KVM 虚拟机
     <div align=center> <img alt="" title="" src=https://kkkkzzzzyy.oss-cn-beijing.aliyuncs.com/云计算/虚拟机添加光盘1.png width=80%/> </div>

   - VMware 虚拟机
     <div align=center> <img alt="" title="" src=https://kkkkzzzzyy.oss-cn-beijing.aliyuncs.com/云计算/虚拟机添加光盘2.png width=80%/> </div>

2. 光盘设备路径 */dev/cdrom -> /dev/sr0*
3. 相关代码
   - 挂载

   ```bash
   mkdir /mnt/dvd
   mount /dev/cdrom /mnt/dvd/

   ls /mnt/dvd/
   ```

   - 卸载

   ```bash
   mount # 查看当前系统所有挂载设备
   
   umount /mnt/dvd # 需要没有用户使用挂载目录

   ls /mnt/dvd/
   ```

## 目录及文件管理

- [查看及切换目录](#查看及切换目录)
  - 使用 `pwd`、`cd`
  - `ls` 列出文档及属性
  - 使用通配符
  - 别名的定义
- [新建目录](#新建目录)
  - `mkdir` 创建目录
- [复制/删除/移动](#复制-删除-移动)
  - `cp` 复制
  - `rm` 删除
  - `mv` 移动/改名

### 查看及切换目录

#### 使用 `pwd`、`cd`

- `pwd` —— Print Working Directory
  - 用途：查看当前工作目录
- cd —— Change Directory
  - 用途：切换工作目录
  - 格式：`cd [目标文件夹位置]`

  ```bash
  # .   当前目录
  # ..  父目录
  # ~user   用户 user 的家目录
  # 家目录：专门存放用户个性化信息的目录

  cd /etc/pki/CA/private/ # 绝对路径
  pwd

  cd ../../               # 相对路径（以当前为参照）
  ```

#### `ls` 列出文档及属性

- `ls` —— List
  - 格式：`ls [选项]... [目录或文件名]...`
- 常用命令选项

  @import "src/csv/admin-3-1.csv"

#### 使用通配符

针对不确定的文档名称，以特殊字符表示：
@import "src/csv/admin-3-2.csv"

#### 别名的定义

- 查看已设置的别名：
  - `alias [别名名称]`
- 定义新的别名：
  - `alias 别名名称='实际执行的命令行'`
- 取消已设置的别名：
  - `unalias [别名名称]`
- 以非别名的形式执行命令（别名与命令字相同时）
  - `/别名名称 ...`

### 新建目录

#### `mkdir` 创建目录

- `mkdir` —— Make Directory
  - 格式：`mkdir [-p] [/路径/]目录名...`
  - `-p` 连同父目录一并创建

### 复制 删除 移动

#### `cp` 复制

- `cp` —— Copy
  - 格式：`cp [选项]... 原文件... 目标路径`
- 常用命令选项
  - `-r`：递归，复制目录时必须有此选项
- 进行强制覆盖
  
  ```bash
  \cp -r /boot /opt # 本次操作临时取消别名
  ```

- 复制可以支持两个以上的参数，最后一个为目标，其他为源数据
  `cp -r /home /boot /etc/passwd /opt`
- 复制与一个点进行连用，将数据复制到当前路径下
  `cp /etc/shells .`

#### `rm` 删除

- `rm` —— Remove
  - 格式：`rm [选项]... 文件或目录...`
- 常用命令选项
  - `-r`、`-f`：递归删除（含目录）、强制删除
  - 通常连用 `-rf`

#### `mv` 移动/改名

- `mv` —— Move
  - 格式：`mv [选项]... 原文件... 目标路径`
  - 路径不变的移动可以用来**重命名**

## 文本内容操作

- [vim 文本编辑器](#vim-文本编辑器)
  - 使用 `vim` 创建/修改文件
- [文件内容过滤](#文件内容过滤)
  - 查找文本内容

### vim 文本编辑器

#### 使用 `vim` 创建/修改文件

- vim 文本编辑器
  - 格式：`vim 文件名`
  - 若目标文件不存在，则新建空文件并编辑
  - 若目标文件已存在，则打开此文件并编辑

  <div align=center> <img alt="" title="" src=https://kkkkzzzzyy.oss-cn-beijing.aliyuncs.com/云计算/VIM文本编辑器.png width=100%/> </div>

- vim 基本操作
  - 保存并退出 `:wq`
  - 放弃修改并退出 `:q!`

### 文件内容过滤

#### 查找文本内容

- 根据字符串模式提取文本行
  - `grep [选项] '匹配模式' 文本文件...`
- 常用命令选项
  - `-v` 取反(不包含)
  - `-i` 忽略大小写
- grep 的匹配模式基于正则表达式，支持多种匹配模式
  1. 基本正则表达式（BRE）：这是 grep 的默认匹配模式，它可以支持简单的模式匹配，如字符类、字符范围、行起始和行结束等。
  2. 扩展正则表达式（ERE）：ERE 是 BRE 的扩展，提供了更多的元字符和操作符，如`?`、`+`、`{}`、`|`和`()`等。
  3. Perl正则表达式（PCRE）：PCRE 是 PERL 语言中的正则表达式，它比 BRE 和 ERE 更加灵活和强大，支持更复杂的模式匹配和文本操作。

#### 扩展：常用的匹配模式

1. 匹配任意单个字符：
   `.` 匹配除换行符外的任意字符

2. 匹配字符类：
3. 
   `[abc]` 匹配 a、b 或 c 中的任意一个字符
   `[^abc]` 匹配除 a、b、c 之外的任意字符

4. 匹配特殊字符：
   `\d` 匹配任意数字字符
   `\D` 匹配任意非数字字符
   `\s` 匹配任意空白字符
   `\S` 匹配任意非空白字符

5. 匹配重复字符：
   `a{3}` 匹配 3 个连续的 a 字符
   `a{2,}` 匹配 2 个或更多个连续的 a 字符

6. 匹配行起始和行结束：
   **`^` 匹配行的开头**
   **`$` 匹配行的结尾**

7. 匹配特殊模式：
   `x\{m,n\}` 匹配 m 到 n 次重复的 x 字符
   `x?` 匹配零个或一个 x 字符
   `x*` 匹配零个或多个 x 字符
   `x+` 匹配一个或多个 x 字符

8. 转义特殊字符：
   `\.` 匹配实际的点字符（.）
   `\\` 匹配实际的反斜杠字符（\）

#### 案例：文本内容操作

问题描述
: 1.利用 grep 过滤 */etc/passwd* 中包含 root 的行
  2.利用 grep 过滤 */etc/passwd* 中以 bash 结尾的行

```bash
grep root /etc/passwd

grep bash$ /etc/passwd
```
